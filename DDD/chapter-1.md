# Domain-Driven Design是什么和发展历史

2004年，Eric Evans完成了《Domain-Driven Design: Tackling Complexity in the Heart of Software》的书籍，其总结了作者在商业和科技领域十年的复杂系统开发经验。领先的软件设计者认识到领域建模和设计的关键至少20年了，但令人惊讶的是，关于需要做什么或如何去做的文章很少。因此作者结合自身经验和在OOP社区暗流的设计哲学思想写作成书。书籍出版后，在此基础理论上涌现和扩充很多新的内容，大致上可以分为三个阶段：Eric Evans的理论原则创建和普及阶段、引入领域事件和事件溯源阶段、微服务架构提出阶段。那么DDD究竟是什么？我的理解是一套综合软件系统分析和设计的面向对象建模方法，具体来说是领域驱动战略设计直面业务需求发现和理解问题空间，价值更聚焦和探索新业务是其附带优势；领域驱动战术设计规范化、模式化了解决空间。

DDD在软件行业越来越受追捧，其内在的原因是什么呢？客观上是随着互联网的发展，业务变得更加复杂的同时对软件质量的要求也越来越高，同时微服务架构的普及和发展也促使了DDD的普及发展和需求。具体可以从三个方面来说：
1） 需求是复杂的，需求的表达又往往带有个人知识“偏见”和逻辑漏洞。因此需求从客户出收集>产品经理整理提出>落地实施都存在偏差和理解不一致的问题。DDD的理念下首先通过统一语言让认知一致，按DDD做出需求分析设计和最终的实施落地的保持一致的。
2）  软件质量越来越受重视，一改就出BUG、新增功能周期长、新人很难快速上手等这些都是软件质量好坏的体现。技术负债的存在是导致软件质量下降的重要原因，通过引入架构元素可以降低技术负责。例如编码前通过对业务模型的头脑风暴缩小领域专家和程序员之间的业务水平落差。
3） 传统的ER数据建模和面向对象建模在面对复杂问题时存在先天的局限。ER数据建模遵循数据库表分析设计范式，对业务实际需求抽象太多，其目标是如何产出服务规范且合理的数据库表而不是忠于输出业务策略、规则等内外部逻辑。最简单的例子是用数据库字段更新代表订单已发货，这种用CRUD用语代替业务用语会忽略业务上下文和重要的业务策略规则；OOA/D的主要问题在于分析和设计之间落差很大，分析阶段的成果经常不能顺利的导入设计阶段。DDD要求分析阶段的概念必需在落地中存在，因此能从需求到落地一竿子捅到底，除了分析和落地一致外，在分析阶段以事件风暴的方式去找出领域事件的本身就是离需求功能更加接近，同时这些领域事件正是日后需要实现的功能所激发的。
综上所述，DDD越来越受软件开发人员重视，同时这也逐渐成为一种基础技能。不过由于DDD本身是一种分析和设计方法，开发人员对其的掌握也变得很难。大部分人都能很快学会其战术设计，但这无法帮助你很好解决当前面对的复杂问题。因为在我看来DDD的精髓在战略设计，即如找出和合理划分有界上下文，上下文中领域如何合理拆分等。正如Alberto Brandolini所说：“不是领域专家的知识进入了生产中的软件，而是开发人员自己的见解悄然渗透到了软件中。”，这也许就是能写代码和会写代码之间的鸿沟，同时也是我认为DDD难学的原因。

DDD这么受重视，那么其本身具有什么特点呢？
1）面向业务需求，由业务驱动。DDD本身就是一种以业务为驱动，不断追寻业务边界的设计思想、方法和活动。采用这种方式进行软件开发和设计，其主要精力是用到对业务需求的分析上，是解决业务问题并进行业务建模。避免过早陷入技术细节和技术狂热，强调技术必须服。手里有了一把锤子，看到什么都是钉子这样是很不好的。因此对问题空间的业务知识深入理解和广泛达成一致共识是DDD的重要步骤。DDD中提供两种方式帮助直面问题和理解业务：面对面协作和阅读代码逆向工程。
2） 划分边界、分而治之。边界划分是DDD中持续动态演进过程中的重要活动，其带有主观倾向的同时又具有客观自然性。领域即边界、边界靠分类、分类需要从内外部入手（内部：事物自身强烈结构特征所显示的边界；外部：客观事物所处上下文环境）。
2） 划分边界、分而治之。边界划分是DDD中持续动态演进过程中的重要活动，其带有主观倾向的同时又具有客观自然性。领域即边界、边界靠分类、分类需要从内外部入手（内部：事物自身强烈结构特征所显示的边界；外部：客观事物所处上下文环境）。
3）致力于解决复杂性。DDD是一套应付复杂性的分析设计方法，如果能够使用CURD能完成绝大部分的简单系统是没有必要应用DDD的，通常一个商业系统是需要持续演进的，演进的过程中业务规则会不断叠加，系统会变得很复杂和难于理解。此时就需要切换为DDD的设计方式。DDD处理复杂性的方式为:通过引入“领域或子域”以及“有界上下文”来划分边界。通过引入各种战术模式让DDD的软件系统条件反射般的易于理解。DDD这种设计套路起作用的原因就在于复杂性本身有两层含义：一是事物的内部组成结构比较多、二是事物本身不容易理解。所以DDD就是通过“拆解成松耦合的组件+使用容易让人明白的套路表达出来”的方式解决复杂性的。
4）需要注重产品的程序员。不是领域专家的知识进入了软件而是开发人员的见解渗透到了软件中，做好DDD的前提是足够了解业务和细节才能做好领域划分。以上都要求程序员关注产品并热衷于参与产品决策的过程，多问几个为什么能帮助了解更多的细节。DDD的实施对开发人员提出了更高的要求。

DDD时解决复杂场景的分析设计方法，其本身有一套范式需要遵循，因此只要这套范式的使用效果相对于范式本身的复杂性而言是合算的，成本不会高于收益，那么就可以使用DDD。首先DDD适合任何有一定复杂性的行业，适合微服务架构（微服务如何合理拆分）。那么不适合使用的场景也有如：能用CURD完成绝大部分功能的简单系统、演示系统或教学案例系统、新系统的1.0版本（需要快速上线验证业务）。






















             