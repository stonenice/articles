# DDD中领域模型纯度与完整性如何抉择？
> 相关链接：https://www.jdon.com/54727
## 内容

电子邮件唯一性检查属于业务逻辑，是应该放到领域模型User类中？还是UserController中？这里有领域模型完整性和纯度的抉择：

领域域模型完整性是指您的域模型包含所有应用程序的域逻辑。按照这个依据，电子邮件唯一性检查属于领域逻辑，领域模型应该包含所有的领域逻辑，放入User中。
域模型的纯洁是指您的域模型不涉及流程外的依赖项。按照这个依据，因为电子邮件的唯一性检查依赖其他选项，应该放入非领域模型的控制器UserController中。
业务逻辑是应用程序中最重要的部分。这也是其中最复杂的部分。将它与其他依赖的额外责任混合在一起，会使逻辑的复杂性变得更大。尽可能避免这种情况。领域域层应去除域逻辑本身以外的所有职责，保证纯度，纯度高于完整性。

三取二

在大多数使用情况下，不能同时具有以下所有3个属性：

领域模型的完整性
域模型纯度
性能
共有三种常用方法，但是每种方法仅能为您提供3种属性中的2种：

将所有外部读取和写入推向业务操作的边缘-保留域模型的完整性和纯净性，但降低性能。
将业务流程外依赖项注入域模型中：保持性能和域模型的完整性，但要以牺牲领域模型的纯度为代价。
在域层和控制器之间分配决策过程：有助于提高性能和域模型的纯度，但是会降低完整性
如果您可以将所有外部读取和写入操作移至业务操作的边缘，而又不会对应用程序性能造成太大损害，请选择此选项。

否则，选择领域模型纯度而非完整性。

## 理解

优先确保领域模型的纯度

# DDD中领域、子域、有界上下文和问题/解决方案空间等概念的定义和关系
> 相关链接：https://www.jdon.com/55400 ### https://www.mirkosertic.de/blog/2013/04/domain-driven-design-example/

## 内容

【领域】

剑桥词典中Domain的定义是：一个感兴趣的区域，或一个某人可以控制的区域（an area of interest or an area over which a person has control）：
- 她把生意当作她的私人领地 - 主观分类 (She treated the business as her private domain.)
- 这些文件属于公共领域等同于文件开放给所有人 - 边界控制 (These documents are in the public domain (= available to everybody).)

域是主观的，它们并不相互排斥。相同的概念可以存在于许多不同的领域。同样是对人群进行划分，按照信仰宗教和皮肤颜色的不同可以得到不同的领域。在对系统进行建模时，我们必须选择最合适的领域边界，以使我们的软件和组织边界保持一致。例如：

|问题空间|按宗教划分领域|按皮肤颜色划分领域|
|---|---|---|
|A-非洲穆斯林、B-阿拉伯穆斯林、C-中国佛教|穆斯林(A,B);佛教(C)|黑种人(A);白种人(B);黄种人(C)|

在DDD中可以得到结论：领域即边界，边界靠分类，分类需要从内外部入手。

【子域】

在DDD中，子域是一个相对术语。域和子域可以互换使用。当我们使用“子域”一词时，我们强调的是，我们所讨论的域是我们已经确定的另一个更高级别域的子级。

因此，每个子域都是一个域，大多数域都是一个子域。只有在我们的模型不包含更高级别的父域时，我才会说域而不是子域。如果一个域可以包含子域，而一个子域是一个域，则子域可以包含子域。域和子域是一个分层的概念。例如：我们在讨论电子商务的话题时，我们将电商作为一个领域，商品和交易作为一个子域。如果将讨论话题定在商品时，原来的商品子域变成了商品领域，标签表达、商品推荐等则作为了子域。

【核心、通用、支持(子)域】

当您将域和子域视为模糊域，并将子域也视为域时，可互换使用核心域和核心子域并不重要。

核心域听起来更好，核心子域强调了它所属的更高级别的域。

【子域与有界上下文】

（子）域是宇宙中概念的互不排斥的任意子集。有界上下文是代表这些概念的模型。相同的子域可以由无数的建模选择表示。
由于有界上下文是一个模型，因此它可以包含来自多个子域的概念。或者可以将单个子域建模为多个有界上下文。

领域或子域存在于人们从问题空间到解决方案空间的解决与设计过程中。问题空间是我们无法接触的一切，解决方案空间是我们可以做出选择的一切


## 理解

DDD中有域、子域、有界上下文、聚合根这些概念，域和子域的划分是问题空间的构造块，关心的是如何把复杂需求分而治之，从聚焦的角度分为核心域、支持域、通用域。而有界上下文、聚合根这些是解决空间的构造块，有了明确的上下文，聚合根才有实际的意义。将问题空间映射到解决空间就是DDD从需求分析到编码实现的过程。

在实践中就将域问题用事件风暴的方式分析出子域，按领域事件分析时考虑关心的各种场景，最终子域也细化成领域模型。最后在领域模型中合理找出聚合根。这是实现DDD的常见过程。


# 有界上下文的理解

有界上下文不能简单理解，例如认为“微服务就是有界上下文”是一种过分简化。在微服务系统中，存在四种有界上下文类型：

- 服务内部的上下文
- 服务的API的上下文
- 服务集群的上下文
- 服务之间的交互上下文


在实际项目中，需要不断解决因为有界上下文、子域和组织的需要共同对齐而引起的混乱。子域属于领域的问题空间边界，组织或人会针对问题空间提出解决方案，有界上下文属于解决方案空间内，问题、组织或人和解决方案这三个空间的概念如何映射和对应不是技术或方法问题，而是管理问题。

一个微服务涉及几个不同上下文，包含核心域对应于的上下文、服务API或服务集群交互的上下文，是一个上下文对于一个小组还是一个微服务对应一个小组。

 
## 理解
限界上下文，在Eric Evans的概念中，说的就是一个边界，是说世界太大了，所以我们所说的东西，最好能在一个边界以内。那么，边界如何划分合理呢？ 子域是最合适的划分方案，这样问题域和方案域就一致了。

当然，由于现实世界不是那么理想的，上下文和子域未必能准确对应，所以你会看到有些人会刻意把限界上下文和子域的边界表达的不一致。我个人不是很原因强调这一点，而更愿意说理想情况：子域的边界就是上下文的边界。
